"use strict";function filter_toggle_field_changed(e){var t=e.attr("type"),a=serialized_form_fields[e.attr("name")],i=e.serialize();"checkbox"==t&&""==i&&(i=void 0),i!=a?filter_field_dirty(e):filter_field_clean(e)}function filter_highlight_changes(e){filter_toggle_field_changed(e);var t=$("[name=filters_open]").serialize();begin_form==t&&filter_clean_all()}function filter_named_filter_clean(){var e=$("[name=source_query_id] option:selected").html();if(e&&"*"==e.charAt(0)){$("[name=source_query_id]").removeClass("tainted");var t=e.substring(2,e.length);$("[name=source_query_id] option:selected").html(t)}}function filter_named_filter_dirty(){var e=$("[name=source_query_id]").val();if(e!=-1){var t=$("[name=source_query_id] option:selected").html();"*"!=t.charAt(0)&&($("[name=source_query_id] option:selected").prepend("* "),$("[name=source_query_id]").addClass("tainted"))}}function filter_field_clean(e){e.parent().removeClass("tainted")}function filter_field_dirty(e){e.parent().hasClass("tainted")||(filter_named_filter_dirty(),e.parent().addClass("tainted"))}function filter_clean_all(){filter_named_filter_clean(),$(".tainted").each(function(){$(this).removeClass("tainted")})}function setBugLabel(){var e=$(".bug-jump-form").find("[name=bug_label]").val(),t=$(".bug-jump").find("[name=bug_id]");""==t.val()&&(t.val(e),t.addClass("field-default"))}function Trim(e){if("string"!=typeof e)return e;var t=e,a="";for(a=t.substring(0,1);" "==a;)t=t.substring(1,t.length),a=t.substring(0,1);for(a=t.substring(t.length-1,t.length);" "==a;)t=t.substring(0,t.length-1),a=t.substring(t.length-1,t.length);return t}function GetCookie(e){var t="MANTIS_"+e,a=document.cookie;a=a.split(";");for(var i=0;i<a.length;){var n=a[i];if(n=n.split("="),Trim(n[0])==t)return n[1];i++}return-1}function SetCookie(e,t){var a="MANTIS_"+e,i=new Date;i.setTime(i.getTime()+31536e6),document.cookie=a+"="+t+"; expires="+i.toUTCString()+";"}function ToggleDiv(e){var t="#"+e+"_open",a="#"+e+"_closed",i=GetCookie("collapse_settings");1==g_collapse_clear&&(i="",g_collapse_clear=0);var n=$(t).css("display");$(t).toggle(),$(a).length&&$(a).toggle(),"none"==n?(i=i.replace("|"+e+":0",""),i=i+"|"+e+":1"):(i=i.replace("|"+e+":1",""),i=i+"|"+e+":0"),SetCookie("collapse_settings",i)}function setDisplay(e,t){document.getElementById(e)||alert("SetDisplay(): id "+e+" is empty"),0!=t?document.getElementById(e).style.display=style_display:document.getElementById(e).style.display="none"}function toggleDisplay(e){setDisplay(e,"none"==document.getElementById(e).style.display?1:0)}var begin_form="",form_fields=new Array,serialized_form_fields=new Array;$(document).ready(function(){var e=0;$("[name=filters_open]").find("input").each(function(){var t=$(this).parent("form").attr("name");"list_queries_open"!=t&&"open_queries"!=t&&"save_query"!=t&&$.inArray($(this).attr("name"),form_fields)==-1&&(form_fields[e]=$(this).attr("name"),e++)}),$.each(form_fields,function(e,t){var a=t.replace(/\[\]/g,"\\[\\]");serialized_form_fields[t]=$("[name=filters_open]").find("[name="+a+"]").serialize()}),begin_form=$("[name=filters_open]").serialize(),$(document).on("change",":input",function(){filter_highlight_changes($(this))}),$(document).on("click",":checkbox",function(){filter_highlight_changes($(this))})});var g_collapse_clear=1,a=navigator.userAgent.indexOf("MSIE"),style_display;style_display=a!=-1?"block":"table-row",style_display="block",$(document).ready(function(){$(".collapse-open").show(),$(".collapse-closed").hide(),$(".collapse-link").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=t.indexOf("_closed_link");a==-1&&(a=t.indexOf("_open_link"));var i=t.substring(0,a);ToggleDiv(i)}),$(".widget-box").on("shown.ace.widget",function(e){var t=$(this).attr("id"),a=GetCookie("collapse_settings");1==g_collapse_clear&&(a="",g_collapse_clear=0),a=a.replace("|"+t+",1",""),a=a+"|"+t+",0",SetCookie("collapse_settings",a)}),$(".widget-box").on("hidden.ace.widget",function(e){var t=$(this).attr("id"),a=GetCookie("collapse_settings");1==g_collapse_clear&&(a="",g_collapse_clear=0),a=a.replace("|"+t+",0",""),a=a+"|"+t+",1",SetCookie("collapse_settings",a)}),$("#sidebar.sidebar-toggle").on("click",function(e){var t=$(this).attr("id"),a=GetCookie("collapse_settings");1==g_collapse_clear&&(a="",g_collapse_clear=0),$(this).parent().hasClass("menu-min")?(a=a.replace("|"+t+",1",""),a=a+"|"+t+",0"):(a=a.replace("|"+t+",0",""),a=a+"|"+t+",1"),SetCookie("collapse_settings",a)}),$("input[type=text].autocomplete").autocomplete({source:function(e,t){var a=$(this).attr("element").attr("id"),i={};i.entrypoint=a+"_get_with_prefix",i[a]=e.term,$.getJSON("xmlhttprequest.php",i,function(e){var a=[];$.each(e,function(e,t){var i={};i.label=$("<div/>").text(t).html(),i.value=t,a.push(i)}),t(a)})}}),$("a.dynamic-filter-expander").click(function(e){e.preventDefault();var t=$(this).attr("id"),a=t+"_target",i=$("#filters_form_open input[name=view_type]").val();$("#"+a).html('<span class="dynamic-filter-loading">'+translations.loading+"</span>"),$.ajax({url:"return_dynamic_filters.php",data:"view_type="+i+"&filter_target="+t,cache:!1,context:$("#"+a),success:function(e){$(this).html(e)},error:function(e,t,a){$(this).html('<span class="error-msg">'+t+": "+a+"</span>")}})}),$("input.autofocus:first, select.autofocus:first, textarea.autofocus:first").focus();var e="";$(":checkbox.check_all").each(function(){var t=$(this).attr("name").replace(/_all$/,"");e.length>0&&(e+=", "),e+=':checkbox[name="'+t+'[]"]'}),e.length>0&&($(e).click(function(){var e=$(this).attr("name").replace(/\[\]/g,""),t=$(this).closest("form").find(':checkbox[name="'+e+'[]"]:checked').length,a=$(this).closest("form").find(':checkbox[name="'+e+'[]"]').length,i=t==a;$(this).closest("form").find(":checkbox[name="+e+"_all]").prop("checked",i)}),$(":checkbox.check_all").click(function(){var e=$(this).attr("name").replace(/_all$/,"");$(this).closest("form").find(':checkbox[name="'+e+'[]"]').prop("checked",$(this).is(":checked"))}));var t={timerID:null,elapsedTime:0,tick:function(){this.elapsedTime+=1e3;var e=Math.floor(this.elapsedTime/1e3)%60,t=Math.floor(this.elapsedTime/6e4)%60,a=Math.floor(this.elapsedTime/36e5)%60;e<10&&(e="0"+e),t<10&&(t="0"+t),a<10&&(a="0"+a),$("input[type=text].stopwatch_time").val(a+":"+t+":"+e),this.start()},reset:function(){this.stop(),this.elapsedTime=0,$("input[type=text].stopwatch_time").val("")},start:function(){this.stop();var e=this;this.timerID=window.setTimeout(function(){e.tick()},1e3)},stop:function(){"number"==typeof this.timerID&&(window.clearTimeout(this.timerID),delete this.timerID)}};$("input[type=button].stopwatch_toggle").click(function(){0==t.elapsedTime?(t.stop(),t.start(),$("input[type=button].stopwatch_toggle").val(translations.time_tracking_stopwatch_stop)):"number"==typeof t.timerID?(t.stop(),$("input[type=button].stopwatch_toggle").val(translations.time_tracking_stopwatch_start)):(t.start(),$("input[type=button].stopwatch_toggle").val(translations.time_tracking_stopwatch_stop))}),$("input[type=button].stopwatch_reset").click(function(){t.reset(),$("input[type=button].stopwatch_toggle").val(translations.time_tracking_stopwatch_start)}),$("input[type=text].datetime").each(function(e,t){$(this).after('&nbsp;<i class="fa fa-calendar fa-lg datetime" id="'+t.id+'_datetime_button"></i>'),Calendar.setup({inputField:t.id,timeFormat:24,showsTime:!0,ifFormat:config.calendar_js_date_format,button:t.id+"_datetime_button"})}),$(".bug-jump").find("[name=bug_id]").focus(function(){var e=$(".bug-jump-form").find("[name=bug_label]").val();$(this).val()==e&&($(this).val(""),$(this).removeClass("field-default"))}),$(".bug-jump").find("[name=bug_id]").blur(function(){var e=$(".bug-jump-form").find("[name=bug_label]").val();""==$(this).val()&&($(this).val(e),$(this).addClass("field-default"))}),$("[name=source_query_id]").change(function(){$(this).parent().submit()}),$("#form-set-project-id").change(function(){$("#form-set-project").submit()}),$("#project-selector").children(".button").hide(),setBugLabel(),$(document).on("click","input[type=checkbox]#use_date_filters",function(){$(this).is(":checked")?($("div.filter-box select[name=start_year]").prop("disabled",!1),$("div.filter-box select[name=start_month]").prop("disabled",!1),$("div.filter-box select[name=start_day]").prop("disabled",!1),$("div.filter-box select[name=end_year]").prop("disabled",!1),$("div.filter-box select[name=end_month]").prop("disabled",!1),$("div.filter-box select[name=end_day]").prop("disabled",!1)):($("div.filter-box select[name=start_year]").prop("disabled",!0),$("div.filter-box select[name=start_month]").prop("disabled",!0),$("div.filter-box select[name=start_day]").prop("disabled",!0),$("div.filter-box select[name=end_year]").prop("disabled",!0),$("div.filter-box select[name=end_month]").prop("disabled",!0),$("div.filter-box select[name=end_day]").prop("disabled",!0))}),$(document).on("change","select[name^=custom_field_][name$=_control]",function(){var e=$(this).closest("table");switch(this.value){case"2":$(e).find("select[name*=_start_year]").prop("disabled",!1),$(e).find("select[name*=_start_month]").prop("disabled",!1),$(e).find("select[name*=_start_day]").prop("disabled",!1),$(e).find("select[name*=_end_year]").prop("disabled",!1),$(e).find("select[name*=_end_month]").prop("disabled",!1),$(e).find("select[name*=_end_day]").prop("disabled",!1);break;case"3":case"4":case"5":case"6":case"7":$(e).find("select[name*=_start_year]").prop("disabled",!1),$(e).find("select[name*=_start_month]").prop("disabled",!1),$(e).find("select[name*=_start_day]").prop("disabled",!1),$(e).find("select[name*=_end_year]").prop("disabled",!0),$(e).find("select[name*=_end_month]").prop("disabled",!0),$(e).find("select[name*=_end_day]").prop("disabled",!0);break;case"0":case"1":default:$(e).find("select[name*=_start_year]").prop("disabled",!0),$(e).find("select[name*=_start_month]").prop("disabled",!0),$(e).find("select[name*=_start_day]").prop("disabled",!0),$(e).find("select[name*=_end_year]").prop("disabled",!0),$(e).find("select[name*=_end_month]").prop("disabled",!0),$(e).find("select[name*=_end_day]").prop("disabled",!0)}}),$("#dates > input[type=image].datetime").hide(),$("#period_menu > select#interval").change(function(){10==$(this).val()?($("#dates > input[type=text].datetime").prop("disabled",!1),$("#dates > input[type=image].datetime").show()):($("#dates > input[type=text].datetime").prop("disabled",!0),$("#dates > input[type=image].datetime").hide())}),$(document).on("change","#tag_select",function(){var e=$("#tag_separator").val(),t=$("#tag_string").val(),a=$(this).val(),i=$("#tag_select option[value="+a+"]").text();t.indexOf(i)==-1&&(t.length>0?$("#tag_string").val(t+e+i):$("#tag_string").val(i)),$(this).val(0)}),$("a.click-url").bind("click",function(){$(this).attr("href",$(this).attr("url"))})}),$(document).ready(function(){$("#db_type").change(function(){var e;e="oci8"==$(this).val()?"oci8":"other",$("#default_"+e+" span").each(function(e,t){var a=$("#"+$(t).attr("name")),i=a.data("defval");"undefined"!=typeof i&&i!=a.val()||a.val($(t).text()),a.data("defval",$(t).text())})}).change()}),$(document).ready(function(){$("#captcha-image, #captcha-refresh li a").click(function(e){var t=$("#captcha-image img"),a=t.attr("src");t.attr("src",a.split("?",1)+"?"+Math.random()),$("#captcha-field").focus(),e.preventDefault()})}),$(document).ready(function(){$("#custom-field-type").on("change",function(){10==$(this).val()?($("#custom-field-default-value").closest(".input").hide(),$("#custom-field-default-value").attr("disabled","disabled"),$("#custom-field-default-value-textarea").closest(".textarea").show(),$("#custom-field-default-value-textarea").removeAttr("disabled")):($("#custom-field-default-value-textarea").closest(".textarea").hide(),$("#custom-field-default-value-textarea").attr("disabled","disabled"),$("#custom-field-default-value").closest(".input").show(),$("#custom-field-default-value").removeAttr("disabled"))}),$("#custom-field-type").trigger("change")});